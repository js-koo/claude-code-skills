# pr-resolver 구현 계획서

## 1. 구현 범위

| 항목 | 내용 |
|------|------|
| 산출물 | `commands/pr-resolver.md` |
| 형식 | Claude Code Custom Command (Markdown) |
| 의존성 | gh CLI, git |

---

## 2. 파일 구조

```
claude-code-skills/
├── README.md                      # 설치 가이드
├── LICENSE
├── docs/
│   ├── pr-resolver-spec.md        # 요구사항 정의서 ✅
│   └── pr-resolver-impl-plan.md   # 구현 계획서 (현재 문서)
└── commands/
    └── pr-resolver.md             # 구현 대상
```

---

## 3. pr-resolver.md 구조

```markdown
---
(frontmatter: 메타데이터)
---

# 제목

## 섹션 1: 환경 확인
## 섹션 2: PR 감지
## 섹션 3: 코멘트 조회
## 섹션 4: 사용자 상호작용
## 섹션 5: 답글 생성
## 섹션 6: 전송
## 섹션 7: 반복
## 섹션 8: 에러 처리
```

---

## 4. 섹션별 구현 상세

### 4.1 Frontmatter

```yaml
---
allowed-tools: Bash(gh:*), Bash(git:*)
argument-hint: [PR번호]
description: PR 리뷰 코멘트 확인 및 답글 처리
---
```

### 4.2 환경 확인

```markdown
## 환경 확인

1. git repo 확인: !`git rev-parse --git-dir 2>/dev/null`
2. gh 인증 확인: !`gh auth status 2>&1`
3. remote 정보: !`git remote -v`

실패 시 에러 메시지 출력 후 종료.
```

### 4.3 PR 감지

```markdown
## PR 감지

인자: $1

1. $1 있으면 → PR 번호로 사용
2. $1 없으면 → !`gh pr view --json number -q '.number'`
3. 실패 시 → 사용자에게 PR 번호 입력 요청
```

### 4.4 코멘트 조회

```markdown
## 코멘트 조회

API: gh api repos/{owner}/{repo}/pulls/{pr}/comments

출력 형식:
┌────┬──────────────────────┬─────────────────────────┐
│ #  │ 파일                  │ 내용 (50자)             │
├────┼──────────────────────┼─────────────────────────┤
│ 1  │ Repository.kt:64     │ SQL 인젝션 위험...      │
│ 2  │ Service.kt:176       │ check() 검증 제거...    │
└────┴──────────────────────┴─────────────────────────┘
```

### 4.5 사용자 상호작용

```markdown
## 사용자 선택

### Step 1: 코멘트 선택
"어떤 코멘트를 처리할까요?" → 번호 입력

### Step 2: 유형 선택
┌─────────────────────────────────────┐
│ 🔴 버그/이슈   │ 🟡 제안          │
│ 🔵 질문       │ 🟢 칭찬/승인      │
│ ⚪ 기타       │                   │
└─────────────────────────────────────┘

### Step 3: 행동 선택
┌─────────────────────────────────────┐
│ 1. 수정 완료   → 답글 + 👍         │
│ 2. 다음에 반영 → 답글 + 👀         │
│ 3. 설명       → 답글만             │
│ 4. 반박       → 답글만             │
│ 5. 스킵       → 👍만               │
│ 6. 칭찬 응답  → ❤️만               │
└─────────────────────────────────────┘
```

### 4.6 답글 생성

```markdown
## 답글 생성

### 수정 완료 / 다음에 반영
1. 코멘트 내용 분석
2. 행동에 맞는 답글 제안
3. 커밋 해시: !`git rev-parse HEAD --short`
4. "이 커밋 맞나요? {hash}" 확인
5. 언어: 코멘트 언어 감지 (한/영)
6. 사용자 확인/수정

### 설명 / 반박
1. 사용자에게 직접 입력 요청
2. 입력 내용 확인
```

### 4.7 전송

```markdown
## 전송

### 답글 전송
gh api repos/{owner}/{repo}/pulls/{pr}/comments/{id}/replies \
  -f body="{답글 내용}"

### 리액션 추가
gh api repos/{owner}/{repo}/pulls/{pr}/comments/{id}/reactions \
  -f content="{+1|eyes|heart}"

### 리액션 매핑
| 행동 | content |
|------|---------|
| 수정 완료 | +1 |
| 다음에 반영 | eyes |
| 스킵 | +1 |
| 칭찬 응답 | heart |
```

### 4.8 반복

```markdown
## 반복

전송 완료 후:
"다른 코멘트도 처리할까요?" [예/아니오]

예 → 코멘트 목록으로 돌아가기
아니오 → 종료
```

### 4.9 에러 처리

```markdown
## 에러 처리

| 상황 | 메시지 |
|------|--------|
| git repo 아님 | "❌ git 저장소에서 실행해주세요." |
| gh 미인증 | "❌ gh auth login을 먼저 실행해주세요." |
| PR 없음 | "❌ PR을 찾을 수 없습니다. PR 번호를 입력해주세요." |
| 코멘트 없음 | "✅ 처리할 코멘트가 없습니다." |
| API 실패 | "❌ GitHub API 오류: {에러 메시지}" |
```

---

## 5. 구현 순서

| # | 작업 | 설명 |
|---|------|------|
| 1 | repo 초기화 | clone, 폴더 구조 생성 |
| 2 | frontmatter 작성 | 메타데이터 정의 |
| 3 | 환경 확인 섹션 | git, gh 체크 로직 |
| 4 | PR 감지 섹션 | 자동/수동 PR 번호 획득 |
| 5 | 코멘트 조회 섹션 | API 호출 및 포맷팅 |
| 6 | 사용자 선택 섹션 | 코멘트/유형/행동 선택 |
| 7 | 답글 생성 섹션 | AI 제안 + 확인 |
| 8 | 전송 섹션 | 답글 + 리액션 API |
| 9 | 반복 섹션 | 계속 여부 확인 |
| 10 | 에러 처리 섹션 | 예외 상황 대응 |
| 11 | 테스트 | 실제 PR로 동작 확인 |
| 12 | README 작성 | 설치/사용법 문서화 |
| 13 | push | GitHub 업로드 |

---

## 6. 테스트 계획

| # | 시나리오 | 예상 결과 |
|---|----------|----------|
| 1 | `/pr-resolver` (PR 있는 브랜치) | PR 자동 감지 |
| 2 | `/pr-resolver 2874` | 지정 PR 사용 |
| 3 | 코멘트 없는 PR | "처리할 코멘트 없음" |
| 4 | 수정 완료 선택 | 답글 + 👍 전송 |
| 5 | 스킵 선택 | 👍만 전송 |
| 6 | 다중 코멘트 처리 | 반복 동작 확인 |

---

## 7. 일정

| # | 작업 | 예상 시간 |
|---|------|----------|
| 1 | pr-resolver.md 작성 | 30분 |
| 2 | 테스트 | 15분 |
| 3 | README 작성 | 10분 |
| 4 | push | 5분 |
| **합계** | | **1시간** |
