# pr-resolver 요구사항 정의서

## 1. 개요

| 항목 | 내용 |
|------|------|
| 이름 | pr-resolver |
| 유형 | Claude Code Custom Command |
| 목적 | PR 리뷰 코멘트 확인 및 답글 처리 자동화 |
| 호출 | `/pr-resolver [PR번호]` |

---

## 2. 실행 환경

| 항목 | 요구사항 |
|------|----------|
| Git | git repo 내에서 실행 |
| GitHub CLI | gh 인증 완료 상태 |
| 권한 | repo read/write |

---

## 3. 실행 흐름

```
┌─────────────────────────────────────────────────────┐
│ 1. PR 번호 감지                                      │
│    └─ 인자 있음 → 사용                               │
│    └─ 인자 없음 → 자동 감지 → 실패시 입력 요청        │
├─────────────────────────────────────────────────────┤
│ 2. 코멘트 조회                                       │
│    └─ gh api로 PR 리뷰 코멘트 목록 가져오기          │
├─────────────────────────────────────────────────────┤
│ 3. 코멘트 목록 표시                                  │
│    └─ 번호, 파일명, 내용 요약                        │
├─────────────────────────────────────────────────────┤
│ 4. 사용자 선택                                       │
│    ├─ 4-1. 처리할 코멘트 선택                        │
│    ├─ 4-2. 유형 선택 (🔴🟡🔵🟢⚪)                    │
│    └─ 4-3. 행동 선택                                 │
├─────────────────────────────────────────────────────┤
│ 5. 답글 생성                                         │
│    ├─ AI가 코멘트+행동 기반 답글 제안                │
│    ├─ 커밋 해시 자동 감지 + 확인                     │
│    └─ 사용자 확인/수정                               │
├─────────────────────────────────────────────────────┤
│ 6. 전송                                              │
│    ├─ 답글 전송 (gh api .../replies)                │
│    └─ 리액션 추가 (gh api .../reactions)            │
├─────────────────────────────────────────────────────┤
│ 7. 반복                                              │
│    └─ "다른 코멘트도 처리할까요?" → Yes면 3번으로    │
└─────────────────────────────────────────────────────┘
```

---

## 4. 코멘트 유형

| 이모지 | 유형 | 설명 |
|--------|------|------|
| 🔴 | 버그/이슈 | 수정 필요한 문제 |
| 🟡 | 제안 | 개선 제안 (선택적) |
| 🔵 | 질문 | 설명 필요 |
| 🟢 | 칭찬/승인 | LGTM 류 |
| ⚪ | 기타 | 분류 안 됨 |

---

## 5. 행동 목록

| 행동 | 설명 | 답글 | 리액션 |
|------|------|------|--------|
| 수정 완료 | 코드 수정함 | ✅ AI 제안 | 👍 |
| 다음에 반영 | 지금은 안 함 | ✅ AI 제안 | 👀 |
| 설명 | 이유 설명 | ✅ 사용자 입력 | ❌ |
| 반박 | 동의 안 함 | ✅ 사용자 입력 | ❌ |
| 스킵 | 이미 해결됨 | ❌ | 👍 |
| 칭찬 응답 | 감사 표시 | ❌ | ❤️ |

---

## 6. 답글 생성 규칙

| 항목 | 규칙 |
|------|------|
| 생성 방식 | AI가 코멘트 내용+행동 분석해서 제안 |
| 커밋 해시 | 자동 감지 (git rev-parse HEAD --short) + 확인 |
| 언어 | 코멘트 언어 감지해서 맞춤 (한/영) |
| 확인 | 전송 전 사용자에게 확인/수정 기회 제공 |

---

## 7. GitHub API

| 용도 | API |
|------|-----|
| PR 정보 | `gh pr view --json number,headRepository` |
| 코멘트 조회 | `gh api repos/{owner}/{repo}/pulls/{pr}/comments` |
| 답글 전송 | `gh api repos/{owner}/{repo}/pulls/{pr}/comments/{id}/replies -f body="..."` |
| 리액션 추가 | `gh api repos/{owner}/{repo}/pulls/{pr}/comments/{id}/reactions -f content="+1"` |

---

## 8. 에러 처리

| 상황 | 처리 |
|------|------|
| git repo 아님 | 에러 메시지 출력 |
| gh 미인증 | `gh auth login` 안내 |
| PR 없음 | PR 번호 입력 요청 |
| 코멘트 없음 | "처리할 코멘트가 없습니다" |
| API 실패 | 에러 메시지 + 재시도 안내 |

---

## 9. 파일 구조

```
~/.claude/commands/
└── pr-resolver.md
```

---

## 10. 허용 도구

```yaml
allowed-tools: Bash(gh:*), Bash(git:*), Read, Grep
```
